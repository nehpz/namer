namer-sdb log:

2025-09-13 22:59:26 | ℹ️ INFO     | watchdog process called for BellesaFilms-The-Crushes.mp4
2025-09-13 22:59:56 | ℹ️ INFO     | Moving /app/media/1-watch/BellesaFilms-The-Crushes.mp4 to /app/media/2-work/BellesaFilms-The-Crushes.mp4 for processing
2025-09-13 22:59:56 | ℹ️ INFO     | Processing: /app/media/2-work/BellesaFilms-The-Crushes.mp4
2025-09-13 22:59:56 | ℹ️ INFO     | ffprobe file "/app/media/2-work/BellesaFilms-The-Crushes.mp4"
2025-09-13 22:59:56 | ℹ️ INFO     | Calculating phash for file "/app/media/2-work/BellesaFilms-The-Crushes.mp4"
2025-09-13 23:00:00 | ⚠️ WARNING  | QSV pipeline (device=/dev/dri/renderD128, decoder=av1_qsv) failed for /app/media/2-work/BellesaFilms-The-Crushes.mp4. Falling back to VAAPI/software. Details: [vost#0:0/apng @ 0x561ecc60ca80] Task finished with error code: -22 (Invalid argument)
[vost#0:0/apng @ 0x561ecc60ca80] Terminating thread with return code -22 (Invalid argument)
[out#0/apng @ 0x561ecc573dc0] Nothing was written into output file, because at least one of its streams received no packets.
frame=    0 fps=0.0 q=0.0 Lsize=       0KiB time=N/A bitrate=N/A speed=N/A    
Conversion failed!
2025-09-13 23:00:09 | ℹ️ INFO     | Calculating oshash for file "/app/media/2-work/BellesaFilms-The-Crushes.mp4"
2025-09-13 23:00:09 | ℹ️ INFO     | Calculated hashes: {'duration': 2239, 'phash': 'dfec7f371e0081c0', 'oshash': '83a6b914bd9c13dd'}
2025-09-13 23:00:09 | ℹ️ INFO     | Moving /app/media/2-work/BellesaFilms-The-Crushes.mp4 to /app/media/4-failed/BellesaFilms-The-Crushes.mp4 for processing


The Crushes
Bellesa Films•2025-08-30

Fingerprints:
Algorithm	Hash	Duration	Submissions	Reports	First Added	Last Added
PHASH	94edfd3e381a85c0	37:19	27		Sep 1, 2025	Sep 13, 2025
OSHASH	5ad8bb5306d9e725	37:19	12		Sep 2, 2025	Sep 13, 2025
OSHASH	9e72f25f63e323d9	37:19	2		Sep 1, 2025	Sep 2, 2025
OSHASH	f0b85da078f8214c	37:19	2		Sep 1, 2025	Sep 5, 2025
OSHASH	5b5a6f557fa35ba0	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	5cacd5995cfaf0d9	37:19	1		Sep 7, 2025	Sep 7, 2025
OSHASH	060f5bbb2baeb2a3	37:19	1		Sep 8, 2025	Sep 8, 2025
OSHASH	9a9dc880123ef71a	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	9fb865f635427356	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	a4ae257edfe0cbb5	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	f72cd801936096ee	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	88cc2a624623c35d	37:19	1		Sep 3, 2025	Sep 3, 2025
OSHASH	44f4fe82013c9513	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	4e48c14e54cd7411	37:19	1		Sep 2, 2025	Sep 2, 2025
OSHASH	54301aff33463eeb	37:19	1		Sep 2, 2025	Sep 2, 2025


## New example

### namer-sdb log
2025-09-14 00:13:19 | ℹ️ INFO     | watchdog process called for Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4
2025-09-14 00:13:49 | ℹ️ INFO     | Moving /app/media/1-watch/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4 to /app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4 for processing
2025-09-14 00:13:49 | ℹ️ INFO     | Processing: /app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4
2025-09-14 00:13:49 | ℹ️ INFO     | ffprobe file "/app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4"
2025-09-14 00:13:49 | ℹ️ INFO     | Calculating phash for file "/app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4"
2025-09-14 00:13:51 | ⚠️ WARNING  | QSV pipeline (device=/dev/dri/renderD128, decoder=h264_qsv) failed for /app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4. Falling back to VAAPI/software. Details: [vost#0:0/apng @ 0x5607db051400] Task finished with error code: -22 (Invalid argument)
[vost#0:0/apng @ 0x5607db051400] Terminating thread with return code -22 (Invalid argument)
[out#0/apng @ 0x5607dafd1d40] Nothing was written into output file, because at least one of its streams received no packets.
frame=    0 fps=0.0 q=0.0 Lsize=       0KiB time=N/A bitrate=N/A speed=N/A    
Conversion failed!
2025-09-14 00:13:54 | ℹ️ INFO     | Calculating oshash for file "/app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4"
2025-09-14 00:13:54 | ℹ️ INFO     | Calculated hashes: {'duration': 2185, 'phash': 'f7210cce9033e13f', 'oshash': 'd78d9abfd71d61b1'}
2025-09-14 00:13:55 | ℹ️ INFO     | Moving /app/media/2-work/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4 to /app/media/4-failed/Tushy.2023.MegaPack.2160p.tushy.23.04.16.azul.hermosa.4k.mp4 for processing

### StashDB
Algorithm	Hash	Duration	Submissions	Reports	First Added	Last Added
PHASH	f76318d88036c77a	36:25	344		Apr 17, 2023	Sep 12, 2025
OSHASH	38736c4aee07423d	36:25	95		Apr 18, 2023	Sep 8, 2025
OSHASH	d78d9abfd71d61b1	36:25	60		Apr 18, 2023	Sep 12, 2025
OSHASH	8bd46006182b1635	36:25	30		Apr 17, 2023	Jul 4, 2025
OSHASH	f4b24ba14ba255b3	36:25	28		Apr 20, 2023	Aug 24, 2025
OSHASH	748b549006e6ba28	36:25	27		Apr 18, 2023	Jul 13, 2025
OSHASH	27d6210eda1089ca	36:25	24		Apr 18, 2023	Sep 12, 2025
OSHASH	52c66909527e5c46	36:25	17		Apr 18, 2023	May 19, 2025
OSHASH	9f327a5a9f1744a6	36:25	7		Apr 18, 2023	Jan 17, 2025
OSHASH	cf81fe4cf469a78e	36:25	5		May 15, 2023	Jul 13, 2025
OSHASH	4227485193fd2a97	36:25	5		May 4, 2023	Jun 2, 2025
OSHASH	c8a331ce6e16f3cb	36:25	5		Apr 28, 2023	Jul 21, 2025
PHASH	f70519d88036e77a	36:09	5		Apr 17, 2024	Apr 15, 2025
OSHASH	c7671f32e2a360c8	36:25	5		May 3, 2023	May 3, 2025
OSHASH	90c20bdee3d8830b	36:25	4		Jun 28, 2024	Jun 14, 2025
OSHASH	70e7fcfa42f2eafe	36:25	4		Feb 29, 2024	May 9, 2024
MD5	73293d3740261d6f45d39bb4db52853d	36:25	4		Apr 21, 2023	Jul 31, 2025
OSHASH	e896948192548ebd	36:25	4		Apr 23, 2023	Feb 4, 2025
MD5	9a6fb68b7769c634a5aa07a9e7b260a8	36:25	4		Apr 21, 2023	Sep 18, 2024
OSHASH	177d258691709bd3	36:25	4		Aug 29, 2023	Sep 11, 2025
OSHASH	decde570ff2c35e0	36:25	4		Jun 26, 2024	Jan 15, 2025
OSHASH	55307dab54b35ab3	36:25	4		Apr 17, 2023	Apr 23, 2023
OSHASH	05037b87f6903e74	36:25	3		May 31, 2023	Mar 8, 2024
MD5	34c480b724773cfc90252a017de16a82	36:25	3		Mar 30, 2024	Jun 25, 2024
OSHASH	ab061bd7aea1993c	36:25	3		Apr 17, 2023	Jun 9, 2023
OSHASH	360b7d4ddbbcb1f7	36:09	3		May 30, 2024	Sep 21, 2024
OSHASH	149d176dadae3254	36:25	2		Jan 30, 2024	Apr 21, 2025
PHASH	b72519d88036e77a	36:09	2		May 30, 2024	Jul 14, 2024
OSHASH	9e7fd0a25ca44f4a	36:25	2		Nov 5, 2024	Mar 2, 2025
OSHASH	e935d9731f274607	36:25	2		Sep 9, 2023	Jan 10, 2025
OSHASH	13a9a8f015ce34cd	36:25	2		Apr 19, 2023	Jun 5, 2024
MD5	57f1a4af5b63d34f157fb8c3bd407ac1	36:25	2		May 1, 2023	May 17, 2023
OSHASH	76c3fbd547de65cd	36:25	2		May 21, 2024	Jan 1, 2025
OSHASH	df2a290cc7405bc6	36:25	2		May 17, 2023	Sep 18, 2024
OSHASH	177d2586f1709c33	36:25	1		Jul 1, 2023	Jul 1, 2023
OSHASH	1960cd589e187171	36:25	1		Oct 22, 2023	Oct 22, 2023
OSHASH	1a83db7637b65be2	36:25	1		Oct 2, 2023	Oct 2, 2023
OSHASH	1bf97142c2c6534a	36:25	1		Aug 23, 2025	Aug 23, 2025
OSHASH	24b89ab7fe2e50c7	36:25	1		Jun 9, 2025	Jun 9, 2025
OSHASH	27d6210f1733ad07	36:25	1		Apr 18, 2023	Apr 18, 2023
OSHASH	2a8879f5b72aaaf8	36:25	1		Nov 9, 2023	Nov 9, 2023
OSHASH	2ebc33d5e72dc2c5	36:25	1		Jun 6, 2023	Jun 6, 2023
OSHASH	30baad28d5bdebdf	36:25	1		Mar 13, 2024	Mar 13, 2024
OSHASH	38736c4a57bb025d	36:25	1		Dec 8, 2024	Dec 8, 2024
OSHASH	3cdb87c237405d54	36:25	1		Jul 5, 2023	Jul 5, 2023
OSHASH	3f6ab8757e59374c	36:25	1		Jun 22, 2023	Jun 22, 2023
OSHASH	41245b19a6ffff16	36:25	1		May 23, 2024	May 23, 2024
OSHASH	48b241ee697644db	36:25	1		Mar 16, 2024	Mar 16, 2024
OSHASH	4c0221997f24e823	36:25	1		May 7, 2023	May 7, 2023
OSHASH	51bba91cb071b920	36:25	1		Feb 2, 2024	Feb 2, 2024
OSHASH	5b28eab93bcbb19b	36:25	1		May 20, 2023	May 20, 2023
OSHASH	5daa284ad792559e	36:09	1		Oct 15, 2024	Oct 15, 2024
OSHASH	5f55fa6d0d45696c	36:25	1		Aug 25, 2024	Aug 25, 2024
OSHASH	6046137088474449	36:25	1		Mar 12, 2025	Mar 12, 2025
OSHASH	615b4f24663d4add	36:25	1		Dec 7, 2023	Dec 7, 2023
OSHASH	61b524b896493617	36:25	1		Mar 14, 2024	Mar 14, 2024
OSHASH	670574f560e9a128	36:25	1		Jun 17, 2025	Jun 17, 2025
OSHASH	6736ee506ffbb08d	36:25	1		Aug 11, 2025	Aug 11, 2025
OSHASH	67a7cfc4de78daf7	36:25	1		Nov 24, 2024	Nov 24, 2024
OSHASH	67e5e85dc6aeb9ea	36:25	1		Apr 28, 2025	Apr 28, 2025
OSHASH	6bc17949dcc58456	36:25	1		Sep 18, 2024	Sep 18, 2024
OSHASH	6d8719586a66c1b9	36:25	1		Dec 26, 2023	Dec 26, 2023
OSHASH	70cd94a821eb57d2	36:25	1		Aug 26, 2025	Aug 26, 2025
OSHASH	734d194b7174361e	04:37	1		Dec 23, 2023	Dec 23, 2023
OSHASH	73f6d58f3cae849a	36:25	1		Jun 1, 2023	Jun 1, 2023
OSHASH	748b549032e6ba54	36:25	1		Apr 19, 2023	Apr 19, 2023
OSHASH	7c1abd5ba8a0f95f	36:25	1		Jun 5, 2024	Jun 5, 2024
OSHASH	7f4794a386d1d2ab	36:25	1		Jun 3, 2023	Jun 3, 2023
OSHASH	84032ff9b9ef6e11	36:25	1		May 4, 2024	May 4, 2024
OSHASH	84eed82c7d8b5206	36:25	1		Apr 30, 2023	Apr 30, 2023
OSHASH	88db38df8b81694c	36:25	1		May 28, 2025	May 28, 2025
OSHASH	8937907ede067baf	36:25	1		Sep 9, 2025	Sep 9, 2025
OSHASH	8be364e1764a37ed	36:25	1		Jun 5, 2024	Jun 5, 2024
OSHASH	8dfa0738ae7bd56c	36:25	1		Jul 3, 2023	Jul 3, 2023
OSHASH	9509d1ed219e54ff	36:25	1		Jan 24, 2025	Jan 24, 2025
OSHASH	9682aeaf6239d202	36:09	1		Apr 17, 2024	Apr 17, 2024
OSHASH	96e1351b61c69f43	36:25	1		Aug 29, 2024	Aug 29, 2024
OSHASH	9778edf4eb917fda	36:25	1		May 17, 2023	May 17, 2023
OSHASH	9a38aee5f16fd352	36:25	1		Nov 11, 2024	Nov 11, 2024
OSHASH	9e22794960613b6e	36:25	1		Oct 15, 2024	Oct 15, 2024
OSHASH	9e8c0c36ef48123f	36:25	1		Oct 29, 2024	Oct 29, 2024
OSHASH	a04752cbff73404d	36:25	1		May 11, 2023	May 11, 2023
OSHASH	a0afd763e9969def	36:25	1		Apr 23, 2023	Apr 23, 2023
OSHASH	a354cef60aeae214	36:25	1		Apr 17, 2024	Apr 17, 2024
OSHASH	a3c7a9845286b771	36:25	1		Sep 30, 2023	Sep 30, 2023
OSHASH	a57b92d83fd5f046	36:25	1		Mar 20, 2024	Mar 20, 2024
OSHASH	a6b53024daeee84c	36:25	1		Jun 29, 2024	Jun 29, 2024
OSHASH	a9052bcb05bdf16d	36:25	1		Apr 9, 2024	Apr 9, 2024
OSHASH	aa1322938be2f9f6	36:09	1		Apr 15, 2025	Apr 15, 2025
OSHASH	aa96649626d1e5f4	36:25	1		Feb 29, 2024	Feb 29, 2024
OSHASH	afba03dfa08899fa	36:25	1		Feb 13, 2024	Feb 13, 2024
OSHASH	b27e156df44656af	36:25	1		Mar 9, 2025	Mar 9, 2025
OSHASH	b4746c4aee0742b9	36:25	1		Feb 2, 2025	Feb 2, 2025
OSHASH	b4f2624a4041d2e7	36:25	1		Sep 19, 2023	Sep 19, 2023
OSHASH	b52f9eac9d5ff6d5	36:25	1		Aug 7, 2023	Aug 7, 2023
OSHASH	b8d107f4fd4d3a31	36:25	1		Jul 31, 2025	Jul 31, 2025
OSHASH	b909f99b367c22a3	36:25	1		May 1, 2023	May 1, 2023
OSHASH	bb650fde44eee975	36:25	1		Oct 28, 2024	Oct 28, 2024
OSHASH	bdb871fa3b0c2d84	36:25	1		Jun 5, 2024	Jun 5, 2024
OSHASH	bee2f667413c985f	36:25	1		Jul 31, 2025	Jul 31, 2025
OSHASH	c3c57289de28026c	36:25	1		Jun 26, 2023	Jun 26, 2023
OSHASH	c69decab620c1690	36:25	1		Apr 17, 2023	Apr 17, 2023
OSHASH	cbfbe17b323de49e	36:25	1		May 14, 2023	May 14, 2023
OSHASH	cfa2e63d13b1a6ae	36:25	1		Jun 1, 2023	Jun 1, 2023
OSHASH	d0715cd1fbde8df1	36:25	1		Jun 2, 2025	Jun 2, 2025
OSHASH	d191402c71e588b2	36:25	1		Mar 31, 2024	Mar 31, 2024
OSHASH	d3cb08099dd716e3	36:25	1		Apr 20, 2023	Apr 20, 2023
OSHASH	d7909278f7140c51	36:25	1		Apr 18, 2023	Apr 18, 2023
OSHASH	da455172e5d8a88e	36:25	1		Nov 1, 2023	Nov 1, 2023
OSHASH	ded4d55034ac6371	36:25	1		Nov 9, 2024	Nov 9, 2024
OSHASH	eb06a6878d9b825b	36:09	1		Jul 14, 2024	Jul 14, 2024
OSHASH	eb7da341442bdf26	36:25	1		Jun 8, 2025	Jun 8, 2025
OSHASH	f2790008d92b4dfd	36:25	1		Mar 23, 2024	Mar 23, 2024
OSHASH	f465d85ad0cb3600	36:25	1		Jun 27, 2023	Jun 27, 2023
OSHASH	f522c4b7b51b1d78	36:25	1		May 7, 2024	May 7, 2024
OSHASH	f9abc5ee9a629354	36:25	1		May 12, 2023	May 12, 2023
OSHASH	fe8dc8167b0d46dd	36:25	1		May 11, 2023	May 11, 2023
PHASH	9c46541ede917d1c	04:37	1		Dec 23, 2023	Dec 23, 2023
PHASH	ad11ded926b1cc32	00:10	1		May 4, 2023	May 4, 2023
PHASH	e727195990789d4e	36:25	1		Jun 8, 2025	Jun 8, 2025
PHASH	f72718d89032c37b	36:25	1		May 25, 2025	May 25, 2025
PHASH	f76318d88036c754	36:25	1		Feb 23, 2025	Feb 23, 2025
MD5	0522d77332d506d37db77b34832108fc	36:25	1		May 20, 2023	May 20, 2023
PHASH	f76318d88036e778	36:25	1		Jul 8, 2024	Jul 8, 2024
MD5	0b068431e37564fc170ad478f2599ddd	36:25	1		Dec 8, 2024	Dec 8, 2024
MD5	0ee6cd8625b8f06629a7548408350a4c	36:25	1		Apr 25, 2023	Apr 25, 2023
MD5	1be8e6538bfeae97526a2542d36a95f2	36:25	1		May 17, 2023	May 17, 2023
MD5	22a5fbe02f54a6c1e46287349782eb7f	36:25	1		Aug 29, 2023	Aug 29, 2023
MD5	2e8a5d54a7c623c7a1761e03c901ea18	36:25	1		Apr 30, 2023	Apr 30, 2023
MD5	3fa9684472a2f295ba681869e9b7af55	36:25	1		Apr 20, 2023	Apr 20, 2023
MD5	508f012680e5184bf2e3622e193029f4	36:25	1		May 31, 2023	May 31, 2023
MD5	509fe8e956d2bd529e0da5f7c1f60bde	36:25	1		Apr 27, 2023	Apr 27, 2023
MD5	5c92aae278cc8cccd8d13e6f85c8a6c9	36:25	1		May 12, 2023	May 12, 2023
MD5	63a24704b65da1d48868d233917e5453	36:25	1		Jun 27, 2023	Jun 27, 2023
MD5	646471c72842c34c26e8faa20f8b117a	36:25	1		Nov 24, 2024	Nov 24, 2024
MD5	7eaba6061c8ad4893d237f26a968ae5f	36:25	1		Jul 16, 2025	Jul 16, 2025
MD5	838ad61e6894b7286f1de7f2f3735e05	36:25	1		May 11, 2023	May 11, 2023
MD5	8be30b90637f8fcbdea9b5672c5a793a	36:25	1		Jun 29, 2024	Jun 29, 2024
MD5	946871248e37496a1f0f3d852823f0f7	36:25	1		Jul 26, 2024	Jul 26, 2024
MD5	acd62f06bcc1531a117ccae203974494	36:25	1		May 1, 2023	May 1, 2023
MD5	b1b77c6678cee9afc34ead677b5e0575	36:25	1		Jul 9, 2023	Jul 9, 2023
MD5	c6da8f95bfe962b68edf77998a838c14	36:25	1		Mar 23, 2024	Mar 23, 2024
MD5	c7af02e8273468c053afb40399ed5571	36:25	1		Apr 20, 2023	Apr 20, 2023
MD5	d224cca7711c22220083452b81047031	36:25	1		Apr 18, 2023	Apr 18, 2023
MD5	ea74bbd64bf5774d6fff9844a0400c68	36:25	1		Jun 26, 2023	Jun 26, 2023
MD5	ef1f7fd6bbc09c31dd6ee52ee88cc7f2	36:25	1		Oct 29, 2024	Oct 29, 2024
OSHASH	004cc0403ecd8c68	00:10	1		May 4, 2023	May 4, 2023
OSHASH	0567b4ce10f5ab4b	36:25	1		May 28, 2025	May 28, 2025

## Root Cause Analysis

After additional investigation, the issue was found to be **format inconsistency across all FFmpeg pipelines**:

### Pipeline Format Differences:
1. **QSV (hardware)**: `format nv12 -> format rgb24` 
2. **VAAPI (hardware)**: `format rgba` ❌ **INCONSISTENT**
3. **Software primary**: `format rgb24` ✅ 
4. **Software fallbacks**: **NO FORMAT PROCESSING** ❌ **INCONSISTENT**

### Key Findings:
- **OSHASH calculation**: Working correctly (matches StashDB fingerprint `d78d9abfd71d61b1`)
- **PHASH calculation**: Still generating wrong hashes due to format inconsistencies
- **Missing format normalization**: Fallback pipelines (tertiary, quaternary, PNG) lacked `format rgb24`

### Fix Applied:
✅ **Standardized all pipelines to use `format rgb24`**:
- VAAPI: Changed `rgba` → `rgb24` for consistency
- All software fallbacks: Added missing `format rgb24` processing
- Both `ffmpeg.py` and `ffmpeg_enhanced.py` updated

### Expected Result:
Consistent hash generation across QSV/VAAPI/Software paths should now match StashDB fingerprints.
OSHASH	05e158c031b69fe0	36:25	1		Apr 17, 2023	Apr 17, 2023
OSHASH	06d07e0b5955d58a	36:25	1		Apr 27, 2023	Apr 27, 2023
OSHASH	0e7a802073959b99	36:25	1		May 8, 2023	May 8, 2023
OSHASH	0f2216925490a8a4	36:25	1		Jul 16, 2025	Jul 16, 2025
OSHASH	1364518132a05b88	36:25	1		Apr 29, 2024	Apr 29, 2024
OSHASH	137bae4547453567	36:25	1		Apr 20, 2023	Apr 20, 2023
OSHASH	145f3b7fb54ab0c8	36:25	1		Jul 8, 2024	Jul 8, 2024
OSHASH	1496de270e1a1fa6	36:25	1		Jul 26, 2025	Jul 26, 2025
OSHASH	1642c16b997bb4fc	36:25	1		Jul 7, 2025	Jul 7, 2025